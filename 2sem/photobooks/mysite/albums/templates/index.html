<!DOCTYPE html>
<html lang="ru">
{% load static %}
<head>
    <meta charset="UTF-8">
    <title>–ì–ª–∞–≤–Ω–∞—è ‚Äî –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —Ñ–æ—Ç–æ–∞–ª—å–±–æ–º–æ–≤</title>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º CSS -->
    <link rel="stylesheet" href="{% static 'albums/style.css' %}">
    <script src="{% static 'albums/main.js' %}" defer></script>
</head>

<body>
<header class="header">
    <div class="container">
        <h1 class="logo">PhotoAlbumCraft</h1>
        <nav class="main-nav">
            <a href="{% url 'index' %}" class="active">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="{% url 'album_list' %}">–ú–æ–∏ –∞–ª—å–±–æ–º—ã</a>
            <div class="theme-toggle" id="themeToggle">
                <span id="themeIcon">üåô</span>
            </div>
        </nav>
    
    </div>
    
</header>

<main class="container">

    <!-- –ü–æ–∏—Å–∫ -->
    <form method="get" class="search-bar">
        <input type="text" name="q" class="search-input"
               placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ —Ñ–æ—Ä–º–∞—Ç—É"
               value="{{ query|default:'' }}">
        <button class="btn-primary" type="submit">–ù–∞–π—Ç–∏</button>
    </form>

    {% if query %}
    <section class="widget">
        <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞: "{{ query }}"</h2>

        {% if search_results %}
            <ol>
                {% for album in search_results %}
                <li class="item">
                    <div class="item-title">{{ album.title }}</div>
                    <div class="item-info">
                        –§–æ—Ä–º–∞—Ç: {{ album.format.name }}<br>
                        –°—Ç–∞—Ç—É—Å: {{ album.status.name }}<br>
                        –§–æ—Ç–æ: {{ album.photo_count }}
                    </div>
                </li>
                {% endfor %}
            </ol>

            {% if total_photos_in_found_albums %}
            <p class="total">–í—Å–µ–≥–æ —Ñ–æ—Ç–æ: {{ total_photos_in_found_albums }}</p>
            {% endif %}
        {% else %}
            <p>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>
        {% endif %}
    </section>
    {% endif %}

    <div class="widgets-grid">

        <!-- –í–∏–¥–∂–µ—Ç: –ú–æ–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∞–ª—å–±–æ–º—ã -->
        <section class="widget">
            <h2>–ú–æ–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∞–ª—å–±–æ–º—ã</h2>
            {% if last_albums %}
            <ol>
                {% for album in last_albums %}
                <li class="item hoverable">
                    <div class="item-title">
                         <a href="{% url 'album_detail' album.id %}" class="clickable">
                           {{ album.title }}
                         </a>
                    </div>
                    <div class="item-info">
                        –§–æ—Ä–º–∞—Ç: {{ album.format.name }}<br>
                        –§–æ—Ç–æ: {{ album.photo_count }}<br>
                        –û–±–Ω–æ–≤–ª—ë–Ω: {{ album.updated_at|date:"d.m.Y H:i" }}
                    </div>
                    <button class="fav-btn {% if album.is_favorite %}fav-btn-active{% endif %}"
                            data-id="{{ album.id }}">
                        <svg class="fav-icon" viewBox="0 0 24 24">
                            <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.62L12 2 
                            9.19 8.62 2 9.24l5.46 4.73L5.82 21z"/>
                        </svg>
                    </button>
                </li>
                {% endfor %}
            </ol>
            {% else %}
            <p>–ù–µ—Ç –∞–ª—å–±–æ–º–æ–≤.</p>
            {% endif %}
        </section>

        <!-- –í–∏–¥–∂–µ—Ç: –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã -->
        <section class="widget">
            <h2>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã</h2>
            {% if popular_formats %}
            <ol>
                {% for fmt in popular_formats %}
                <li class="item">
                    <div class="item-title">{{ fmt.name }}</div>
                    <div class="item-info">
                        –†–∞–∑–º–µ—Ä: {{ fmt.width_mm }}√ó{{ fmt.height_mm }} –º–º<br>
                        –ó–∞–∫–∞–∑–æ–≤: {{ fmt.order_count }}
                    </div>
                </li>
                {% endfor %}
            </ol>
            {% else %}
            <p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö.</p>
            {% endif %}
        </section>

        <!-- –í–∏–¥–∂–µ—Ç: –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã -->
        <section class="widget">
            <h2>–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã</h2>
            {% if active_orders %}
            <ol>
                {% for order in active_orders %}
                <li class="item">
                    <div class="item-title">–ó–∞–∫–∞–∑ #{{ order.id }}</div>
                    <div class="item-info">
                        –°—Ç–∞—Ç—É—Å: {{ order.status }}<br>
                        –°—É–º–º–∞: {{ order.total_price }} ‚ÇΩ
                    </div>
                </li>
                {% endfor %}
            </ol>
            {% else %}
            <p>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤.</p>
            {% endif %}
        </section>
    </div>
</main>

</body>
</html>
